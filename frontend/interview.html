<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ –û–Ω–ª–∞–π–Ω-—Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .chat-container { max-width: 700px; margin: 20px auto; border: 1px solid #ddd;
            border-radius: 10px; padding: 15px; background: #fafafa; }
        .chat-box { height: 400px; overflow-y: auto; border: 1px solid #ccc;
            padding: 10px; margin-bottom: 15px; background: white; }
        .msg { margin: 8px 0; padding: 8px 12px; border-radius: 8px; max-width: 80%; }
        .msg.bot { background: #e3f2fd; align-self: flex-start; }
        .msg.user { background: #c8e6c9; align-self: flex-end; margin-left: auto; }
        .chat-input { display: flex; gap: 10px; }
        .chat-input input { flex: 1; padding: 8px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ –û–Ω–ª–∞–π–Ω-—Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ</h1>
            <p>–ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –∏–Ω—Ç–µ—Ä–≤—å—é –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º–µ</p>
        </div>

        <div class="chat-container">
            <div class="chat-box" id="chat-box"></div>
            
            <div id="setup-section">
                <label>–¢–µ–º–∞: <input type="text" id="topic" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Python"></label>
                <label>–£—Ä–æ–≤–µ–Ω—å: 
                    <select id="level">
                        <option value="junior">Junior</option>
                        <option value="middle" selected>Middle</option>
                        <option value="senior">Senior</option>
                    </select>
                </label>
                <button onclick="startInterview()">–ù–∞—á–∞—Ç—å —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ</button>
            </div>

            <div id="chat-section" class="hidden">
                <div class="chat-input">
                    <input type="text" id="user-answer" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..." 
                           onkeypress="if(event.key==='Enter'){sendAnswer();}">
                    <button onclick="sendAnswer()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let sessionId = null;

        function addMessage(text, sender) {
            const chatBox = document.getElementById("chat-box");
            const div = document.createElement("div");
            div.className = `msg ${sender}`;
            div.textContent = text;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function startInterview() {
            const topic = document.getElementById("topic").value.trim();
            const level = document.getElementById("level").value;

            const resp = await fetch("/api/start_interview", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ topic, level })
            });
            const data = await resp.json();
            if (data.error) {
                alert("–û—à–∏–±–∫–∞: " + JSON.stringify(data.error));
                return;
            }
            sessionId = data.session_id;
            document.getElementById("setup-section").classList.add("hidden");
            document.getElementById("chat-section").classList.remove("hidden");

            addMessage("–ò–Ω—Ç–µ—Ä–≤—å—é –Ω–∞—á–∞–ª–æ—Å—å! " + data.question, "bot");
        }

        async function sendAnswer() {
            const input = document.getElementById("user-answer");
            const answer = input.value.trim();
            if (!answer) return;
            addMessage(answer, "user");
            input.value = "";

            const resp = await fetch("/api/answer", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ session_id: sessionId, answer })
            });
            const data = await resp.json();

            if (data.reasoning) {
                addMessage("–û—Ü–µ–Ω–∫–∞: " + data.reasoning + " (–ë–∞–ª–ª—ã: " + data.score + ")", "bot");
            }
            if (data.next_question) {
                addMessage(data.next_question, "bot");
            }
            if (data.finished) {
                if (data.passed) {
                    addMessage("‚úÖ –ò–Ω—Ç–µ—Ä–≤—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–æ: –ö–∞–Ω–¥–∏–¥–∞—Ç –ø—Ä–æ—à—ë–ª!", "bot");
                } else {
                    addMessage("‚ùå –ò–Ω—Ç–µ—Ä–≤—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–æ: –ö–∞–Ω–¥–∏–¥–∞—Ç –Ω–µ –ø—Ä–æ—à—ë–ª.", "bot");
                }
                document.getElementById("chat-section").classList.add("hidden");
            }
        }
    </script>
</body>
</html>
